@namespace CommandCentre.Components

@using Spectre.Console
@using RazorConsole.Core.Focus
@using System.Threading.Tasks

@inject NavigationManager Nav
@inject FocusManager FocusManager

<Select Options="@(_tabs.Select(t => t.Label).ToArray())"
        Value="@SelectedTab"
        ValueChanged="@SelectTab"
        IsFocused="@IsFocused"
        IsFocusedChanged="@OnSelectFocusChanged"
        Expand="false" />

@code {
    private string SelectedTab = "Home";
    private readonly (string Key, string Label)[] _tabs = new[]
    {
        ("home", "Home"),
        ("repositories", "Repositories"),
        ("utilities", "Utilities"),
        ("playground", "Playground"),
        ("improvements", "Improvements"),
        ("settings", "Settings"),
    };

    private async Task SelectTab(string tabName)
    {
        var key = _tabs.FirstOrDefault(t => t.Label == tabName).Key;
        if (key == null)
        {
            throw new InvalidOperationException($"Tab '{tabName}' not found.");
        }
        SelectedTab = tabName;
        Nav.NavigateTo(key);

        await MoveFocus();
    }

    [Parameter]
    public bool IsFocused { get; set; }

    [Parameter]
    public EventCallback<bool> IsFocusedChanged { get; set; }

    private async Task OnSelectFocusChanged(bool isFocused)
    {
        if (IsFocused == isFocused)
        {
            return;
        }

        IsFocused = isFocused;

        if (IsFocusedChanged.HasDelegate)
        {
            await IsFocusedChanged.InvokeAsync(isFocused).ConfigureAwait(false);
        }

        await InvokeAsync(StateHasChanged).ConfigureAwait(false);
    }

    private async Task MoveFocus()
    {
        await Task.Delay(100); // allow time for navigation to complete
        await FocusManager.FocusNextAsync();
    }

}